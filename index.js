const chalk=require("chalk"),TAG_ARGUMENTS="[object Arguments]",TAG_ARRAY="[object Array]",TAG_ARRAY_BUFFER="[object ArrayBuffer]",TAG_ASYNC_FUNCTION="[object AsyncFunction]",TAG_BIGINT="[object BigInt]",TAG_BOOL="[object Boolean]",TAG_DATE="[object Date]",TAG_ERROR="[object Error]",TAG_FUNCTION="[object Function]",TAG_GENERATOR="[object Generator]",TAG_GENERATOR_FUNCTION="[object GeneratorFunction]",TAG_GLOBAL="[object global]",TAG_MAP="[object Map]",TAG_NULL="[object Null]",TAG_NUMBER="[object Number]",TAG_OBJECT="[object Object]",TAG_PROMISE="[object Promise]",TAG_REGEXP="[object RegExp]",TAG_SET="[object Set]",TAG_SHARED_ARRAY_BUFFER="[object SharedArrayBuffer]",TAG_STRING="[object String]",TAG_SYMBOL="[object Symbol]",TAG_VOID="[object Undefined]",TAG_WEAK_MAP="[object WeakMap]",TAG_WEAK_SET="[object WeakSet]",TAG_WINDOW="[object Window]";function clearCli(){if("clear"in console)try{console.clear()}catch(t){}else try{process.stdout.write("[2J[0;0H")}catch(t){}}function processExit(){try{process.exit(0)}catch(t){}}function isNumericKey(t){return Number.isInteger(Number.parseInt(t))}function prototypeTag(t){return Object.prototype.toString.call(t)}function clearString(t){return t.length<12?t:(" "+t).slice(1)}function deCycle(t){const e=[],r=[];return function deReCycle(i,s){let n,o,a;if(!("object"!=typeof i||null===i||i instanceof Boolean||i instanceof Date||i instanceof Number||i instanceof RegExp||i instanceof String)){for(n=0;n<e.length;n+=1)if(e[n]===i)return{"&circularReference":r[n]};if(e.push(i),r.push(s),prototypeTag(i)===TAG_ARRAY)for(a=[],n=0;n<i.length;n+=1)a[n]=deReCycle(i[n],`${s}[" + index + "]`);else for(o in a=Object.create(t),i)Object.prototype.hasOwnProperty.call(i,o)&&(a[o]=deReCycle(i[o],`${s}[${JSON.stringify(o)}]`));return a}return i}(t,"&")}function closureNameExtract(t){if(t.name)return t.name;const e=/^function\s+([\w\$]+)\s*\(/.exec(t.toString());return e?e[1]:""}function objSize(t){return Object.keys(t).length}function getClass(t){return t.constructor.name}function getType(t){let e=prototypeTag(t).toLowerCase().split("[object ").pop().split("]").shift();return["global","window"].includes(e)?"object":e.includes("error")?"error":e}class Theme{constructor(){this.cli=new chalk.Instance({level:3})}out(t,e=255,r=255,i=255){return this.cli.rgb(e,r,i)(t.toString())}argument(t){return this.out(t,253,151,31)}boolean(t){return this.out(t,174,129,255)}comment(t){return this.out(t,117,113,94)}keyword(t){return this.out(t,249,38,114)}string(t){return this.out(t,166,226,46)}number(t){return this.out(t,174,129,255)}property(t){return this.out(t,102,217,239)}name(t){return this.out(t,230,219,116)}}class Consono{constructor(t={}){this.setOptions(t),this.cli=new Theme}setOptions(t={}){const e={arrayMaxElements:99,assignSymbol:"â†’",clear:!1,console:!0,depth:20,exit:!1,indent:"Ë‘Ë‘",indentPad:1,objectMaxProps:99,quotesEnd:'"',quotesStart:'"',stringMaxLength:360,...t};this.arrayMaxElements=e.arrayMaxElements,this.arrow=e.assignSymbol,this.clear=e.clear,this.console=e.console,this.currentDepth=0,this.depth=e.depth,this.exit=e.exit,this.indentType=e.indent,this.indent=this.indentType.repeat(e.indentPad),this.objectMaxProps=e.objectMaxProps,this.quotesEnd=e.quotesEnd,this.quotesStart=e.quotesStart,this.stringMaxLength=e.stringMaxLength}toPrintable(t,e="",r=!0,i=""){let s="",n="",o="",a=Number.MAX_SAFE_INTEGER;const c=getType(t);switch(c){case"array":n=`${this.cli.keyword("array")}${i.length?` ${this.cli.keyword(i)}`:""} (${this.cli.argument("elements")}=${this.cli.number(t.length)}) [\n`,o=`${e}]`,a=this.arrayMaxElements;break;case"object":const s=t;if(t=deCycle(t),!0===r){const r=objSize(t);let i="";i=r>this.objectMaxProps?`(${this.cli.argument("props")}=${this.cli.number(r)}, ${this.cli.argument("shown")}=${this.cli.number(this.objectMaxProps)})`:`(${this.cli.argument("props")}=${this.cli.number(r)})`,n=`${this.cli.keyword("object")} ${this.cli.keyword(getClass(s))} ${i} {\n`,o=`${e}}`}else n="(\n",o=`${e})`;a=this.objectMaxProps;break;case"arguments":n=`${this.cli.keyword("arguments")} (${this.cli.argument("arity")}=${this.cli.number(t.length)}) [\n`,o=`${e}]`,a=this.arrayMaxElements;break;case"set":n=`${this.cli.keyword("set")} (${this.cli.argument("size")}=${this.cli.number(t.size)}) {\n`,o=`${e}}`,a=this.arrayMaxElements;break;case"map":n=`${this.cli.keyword("map")} (${this.cli.argument("size")}=${this.cli.number(t.size)}) {\n`,o=`${e}}`,a=this.objectMaxProps;break;default:return this.formatValue(e,t)}let l=0;switch(c){case"set":const r=Array.from(t);for(const t in r){const i=r[t],n=this.formatValue(e,i);if(s+=this.formatAssign("set",e,t,n),(l+=1)>=a)break}break;case"map":for(const r of t.entries()){const[t,i]=r,n=this.formatValue(e,{key:t,value:i},!1);if(s+=this.formatAssign("map",e,t,n),(l+=1)>=a)break}break;default:for(const r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;const i=t[r],n=getType(i),o=this.formatValue(e,i);if(s+=this.formatAssign(n,e,r,o),(l+=1)>=a)break}}return`${n}${s}${o}`}formatValue(t,e,r=!0){let i="",s=getType(e),n="";const o=prototypeTag(e);switch(o){case TAG_VOID:[s,i]=this.formatUndefined();break;case TAG_NULL:[s,i]=this.formatNull();break;case TAG_GLOBAL:case TAG_WINDOW:[s,i]=this.formatGlobal(o,e,t);break;case TAG_BIGINT:[s,i]=this.formatBigInt(e);break;case TAG_NUMBER:[s,i]=this.formatNumber(e);break;case TAG_BOOL:[s,i]=this.formatBoolean(e);break;case TAG_STRING:[s,i]=this.formatString(e);break;case TAG_REGEXP:[s,i]=this.formatRegexp(e);break;case TAG_FUNCTION:case TAG_ASYNC_FUNCTION:case TAG_GENERATOR_FUNCTION:[s,i]=this.formatFunction(o,e);break;case TAG_DATE:[s,i]=this.formatDate(e);break;case TAG_ARGUMENTS:[s,i]=this.formatArguments(e);break;case TAG_SYMBOL:[s,i]=this.formatSymbol(e);break;case TAG_PROMISE:[s,i]=this.formatPromise(e);break;case TAG_GENERATOR:[s,i]=this.formatGenerator(e);break;case TAG_ERROR:[s,i]=this.formatError(e);break;case TAG_WEAK_SET:case TAG_WEAK_MAP:[s,i]=this.formatWeak(o,e);break;case TAG_SET:[s,i]=this.formatSet(e);break;case TAG_MAP:[s,i]=this.formatMap(e);break;case TAG_ARRAY_BUFFER:case TAG_SHARED_ARRAY_BUFFER:[s,i]=this.formatBuffer(o,e);break;default:if(o.includes("Array"))s="array",n=getClass(e).toLowerCase(),e=Array.from(e);else if(o.includes("Iterator]")){const i=o.split(" ")[1];if("Set"===i)return this.toPrintable(new Set(Array.from(e).map(t=>t[1])),t,r);if("Map"===i)return this.toPrintable(new Map(Array.from(e)),t,r);if("String"===i)return this.toPrintable(Array.from(e).map(t=>t[1]).join(""),t,r);if("Array"===i)return this.toPrintable(Array.from(e).map(t=>t[1]),t,r)}}switch(s){case"array":case"object":if(s="",this.currentDepth===this.depth){const t=objSize(e);let r="";r=t>this.objectMaxProps?`(${this.cli.argument("props")}=${this.cli.number(t)}, ${this.cli.argument("shown")}=${this.cli.number(this.objectMaxProps)})`:`(${this.cli.argument("props")}=${this.cli.number(t)})`,i=`${this.cli.keyword("object")} ${this.cli.keyword(getClass(e))} ${r}`}else{this.currentDepth+=1;const o="array"===s?`${this.cli.comment(t)}`:`${t}${this.cli.comment(this.indent)}`;i=this.toPrintable(e,o,r,n),this.currentDepth-=1}break;default:s.length||(s=o.split("[object ").pop().split("]").shift().toLowerCase(),i=e.toString())}return`${this.cli.keyword(s)}${s.length?this.cli.comment(" â€¢ "):""}${i}`}formatArguments(t){return["arguments",this.toPrintable(t)]}formatBigInt(t){return["number bigint",this.cli.number(t)]}formatBoolean(t){return["boolean",this.cli.boolean(t)]}formatBuffer(t,e){return[TAG_ARRAY_BUFFER?"array buffer":"array buffer shared",`(${this.cli.argument("bytes")}=${this.cli.number(e.byteLength)})`]}formatDate(t){return["date",this.cli.name(t.toISOString()+" â€¢ "+t.toString())]}formatError(t){return[`error ${getClass(t)}`,this.cli.string(t.message)]}formatFunction(t,e){let r="function";switch(t){case TAG_ASYNC_FUNCTION:r=`${r} async`;break;case TAG_GENERATOR_FUNCTION:r=`${r} generator`}const i=closureNameExtract(e);r=i.length?`${r} ${this.cli.name(i)}`:`${r} anonymous`;const s=`${e}`.replace(/\n+/g,"").split(")").shift()+") {â€¦}";return[r,this.cli.argument(s)]}formatGenerator(t){return["generator",this.cli.argument("Generator {â€¦}")]}formatGlobal(t,e,r){return[`global ${t===TAG_WINDOW?"window":"this"}`,this.toPrintable({...e},`${r}${this.cli.comment(this.indent)}`)]}formatMap(t){return["map",this.toPrintable(t)]}formatNull(){return["empty",this.cli.string("null")]}formatNumber(t){let e="";return Number.isFinite(t)?e=Number.isInteger(t)?"number integer":"number float":(e="number",Number.isNaN(t)?e+=" nan":t===Number.POSITIVE_INFINITY?e+=" positive infinity":e+=" negative infinity"),[e,this.cli.number(t)]}formatPromise(t){return["promise",this.cli.argument("Promise {â€¦}")]}formatRegexp(t){return[`regexp ${t.flags}`,this.cli.name(t)]}formatSet(t){return["set",this.toPrintable(t)]}formatString(t){const e=[...t],r=e.length,i=t.length;let s="";this.stringMaxLength>0&&(s=i!==r?e.slice(0,this.stringMaxLength).join(""):t.slice(0,this.stringMaxLength));let n="";return n=i===r?`${this.cli.string(this.quotesStart)}${this.cli.string(s||t)}${this.cli.string(this.quotesEnd)} (${this.cli.argument("length")}=${this.cli.number(i)}`:`${this.cli.string(this.quotesStart)}${this.cli.string(s||t)}${this.cli.string(this.quotesEnd)} (${this.cli.argument("length")}=${this.cli.number(i)}, ${this.cli.argument("symbols")}=${this.cli.number(r)}`,n=r>this.stringMaxLength?`${n}, ${this.cli.argument("shown")}=${this.cli.number(this.stringMaxLength)})`:`${n})`,clearString(s),["string",n]}formatSymbol(t){return["symbol",t.toString()]}formatUndefined(){return["empty",this.cli.string("undefined")]}formatWeak(t,e){return t===TAG_WEAK_MAP?["map weak",""]:["set weak",""]}formatAssign(t,e,r,i){let s;return"map"===t?`${e}${this.cli.comment(this.indent)}${i},\n`:"set"===t?`${e}${this.cli.comment(this.indent)}${this.arrow} ${i},\n`:(s=isNumericKey(r)||"array"===t&&"string"!=typeof r?`${this.cli.argument("[")}${this.cli.name(r)}${this.cli.argument("]")}`:`${this.cli.argument(this.quotesStart)}${this.cli.name(r)}${this.cli.argument(this.quotesEnd)}`,`${e}${this.cli.comment(this.indent)}${s} ${this.arrow} ${i},\n`)}log(t){if(!this.console)return this.toPrintable(t);this.clear&&clearCli(),console.log(this.toPrintable(t)),this.exit&&processExit()}}function consono(t,e=!0){const r={console:!0};"boolean"==typeof e?r.console=e:e&&"object"==typeof e&&Object.assign(r,e);const i=new Consono(e);if(!r.console)return i.toPrintable(t);r.clear&&clearCli(),console.log(i.toPrintable(t)),r.exit&&processExit()}Consono.factory=function factory(t=!0){const e={console:!0};"boolean"==typeof t?e.console=t:t&&"object"==typeof t&&Object.assign(e,t);const r=new Consono(t);return function consono(t){if(!e.console)return r.toPrintable(t);e.clear&&clearCli(),console.log(r.toPrintable(t)),e.exit&&processExit()}},module.exports.default=consono,module.exports.consono=consono,module.exports.Consono=Consono;